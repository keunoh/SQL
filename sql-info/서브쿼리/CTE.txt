파생테이블, CTE, APPLY 활용

성능 좋은 고급 쿼리 적용 예
1. 중복 I/O 제거 - "같은 데이터는 2번 이상 중복해서 읽지 않는다"
  A. JOIN으로 변경
  B. 기준 결과 집합 선 처리 후 결합
  C. 행 복제
2. 연산 순서 조정 -  더 나은 순서로 연산 처리
  - Ex. 결합(Join, Subquery) 전 Group 먼저
    - (거래 데이터 x 코드 테이블) -> 집계 vs (거래 데이터 -> 집계) x 코드 테이블

3. Subquery에서 CASE WHEN 사용할 때 CASE 절에 SELECT를 사용한다면, 
   WHEN 갯수만큼 반복액세스하기 때문에 사용하지 말기를 권장
  - Ex. 
--------------------- 잘못 사용된 예
SELECT
	OrderID, 
	CASE (SELECT Country FROM dbo.Customers cu WHERE cu.CustomerID = oh.CustomerID) 
		WHEN 'Germany' THEN 'Germany'    
		WHEN 'Mexico' THEN 'Mexico'
		WHEN 'UK' THEN 'UK'
		ELSE 'N/A'    
	END
FROM dbo.Orders AS oh
WHERE OrderID <= 10250

----------------------> 아래와 같이 수정
/*
권장 - Subquery 내 CASE
*/
SELECT
	OrderID, 
	(SELECT CASE Country 
				WHEN 'Germany' THEN 'Germany'    
				WHEN 'Mexico' THEN 'Mexico'
				WHEN 'UK' THEN 'UK'
				ELSE 'N/A'    
			END	
	FROM dbo.Customers cu 
	WHERE cu.CustomerID = oh.CustomerID) AS Country
FROM dbo.Orders AS oh
WHERE OrderID <= 10250;

